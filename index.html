<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simplex Iteration Visualizer</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; padding: 20px; max-width: 900px; margin: auto; background-color: #f9f9f9; }
        h1, h2, h3 { color: #333; }
        .config-section, .input-section { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .input-row { display: flex; align-items: center; margin-bottom: 10px; flex-wrap: wrap; }
        input[type="number"] { width: 70px; padding: 5px; margin: 0 5px; border: 1px solid #ccc; border-radius: 4px; }
        button { background-color: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-size: 16px; margin-top: 10px; }
        button:hover { background-color: #0056b3; }
        
        table { border-collapse: collapse; width: 100%; margin: 15px 0; font-size: 14px; background: white; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
        th { background-color: #f2f2f2; }
        
        .pivot-col { background-color: #e6f7ff; }
        .pivot-row { background-color: #fff0f0; }
        .pivot-element { background-color: #ffeb3b; font-weight: bold; border: 2px solid #ff9800; }
        
        .iteration-box { border: 1px solid #ccc; padding: 15px; margin-bottom: 20px; background: white; }
        .optimal-res { color: green; font-weight: bold; font-size: 1.2em; }
        .hidden { display: none; }
    </style>
</head>
<body>

    <h1>Simplex Iteration Visualizer V 0.0</h1>

    <div style="text-align: center; margin: 20px 0;">
        <img src="https://i.ibb.co/C3KMKT9N/photo-2023-07-08-02-41-40-2.jpg" 
             alt="Simplex Logo" 
             style="max-width: 100%; max-height: 300px; height: auto; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
    </div>

    <div class="config-section">
        <h3>Configuration</h3>
        <label>Variables: <input type="number" id="numVars" value="2" min="1"></label>
        <label>Constraints: <input type="number" id="numConstraints" value="2" min="1"></label>
        <button onclick="generateInputs()">Generate Inputs</button>
    </div>

    <div id="matrix-inputs" class="input-section hidden">
        <h3>Objective Function (Max Z)</h3>
        <div id="obj-inputs" class="input-row"></div>
        
        <h3>Constraints (<=)</h3>
        <div id="constraint-inputs"></div>
        
        <button onclick="solveSimplex()">Solve</button>
    </div>

    <div id="output-area"></div>

    <script>
        let numVars = 0;
        let numConstraints = 0;

        function fmt(num) {
            return parseFloat(num.toFixed(3));
        }

        function generateInputs() {
            numVars = parseInt(document.getElementById('numVars').value);
            numConstraints = parseInt(document.getElementById('numConstraints').value);
            
            const objContainer = document.getElementById('obj-inputs');
            objContainer.innerHTML = '';
            for (let i = 0; i < numVars; i++) {
                objContainer.innerHTML += `X${i+1}: <input type="number" id="z_var_${i}" placeholder="0"> `;
            }

            const constContainer = document.getElementById('constraint-inputs');
            constContainer.innerHTML = '';
            for (let i = 0; i < numConstraints; i++) {
                let html = `<div class="input-row"><strong>C${i+1}:</strong> `;
                for (let j = 0; j < numVars; j++) {
                    html += `X${j+1} <input type="number" id="c_${i}_${j}" placeholder="0"> + `;
                }
                html = html.slice(0, -3); 
                html += ` <= <input type="number" id="rhs_${i}" placeholder="0"></div>`;
                constContainer.innerHTML += html;
            }

            document.getElementById('matrix-inputs').classList.remove('hidden');
            document.getElementById('output-area').innerHTML = '';
        }

        function solveSimplex() {
            trackSolveClick();
            const outputDiv = document.getElementById('output-area');
            outputDiv.innerHTML = '';

            let zVars = [];
            for (let i = 0; i < numVars; i++) {
                let val = document.getElementById(`z_var_${i}`).value;
                zVars.push(val === "" ? 0 : parseFloat(val));
            }

            let constraintsCo = [];
            let rhs = [];
            let slacksCo = [];
            
            for (let i = 0; i < numConstraints; i++) {
                let row = [];
                for (let j = 0; j < numVars; j++) {
                    let val = document.getElementById(`c_${i}_${j}`).value;
                    row.push(val === "" ? 0 : parseFloat(val));
                }
                constraintsCo.push(row);
                
                let rVal = document.getElementById(`rhs_${i}`).value;
                rhs.push(rVal === "" ? 0 : parseFloat(rVal));

                let slackRow = new Array(numConstraints).fill(0.0);
                slackRow[i] = 1.0;
                slacksCo.push(slackRow);
            }

            let zSlacks = new Array(numConstraints).fill(0.0);
            
            for (let i = 0; i < numVars; i++) {
                zVars[i] *= -1;
            }
            
            let zValue = 0.0;
            let basicVarNames = [];
            for (let i = 0; i < numConstraints; i++) {
                basicVarNames.push(`s${i+1}`);
            }

            let augHTML = `<h3>Augmented Form</h3>
            <div style="background:#fff; border:1px solid #ccc; padding:15px; font-family:'Courier New', monospace; margin-bottom:20px; line-height: 1.6;">`;

            
            augHTML += `(0) Z`;
            for (let i = 0; i < numVars; i++) {
                let val = zVars[i]; 
                if (val >= 0) augHTML += ` + ${fmt(val)}X${i+1}`;
                else          augHTML += ` - ${fmt(Math.abs(val))}X${i+1}`;
            }
            for (let i = 0; i < numConstraints; i++) {
                augHTML += ` + 0S${i+1}`;
            }
            augHTML += ` = 0<br>`;

            for (let i = 0; i < numConstraints; i++) {
                augHTML += `(${i+1}) `;
                
                
                for (let j = 0; j < numVars; j++) {
                    let val = constraintsCo[i][j];
                    if (val >= 0) augHTML += ` + ${fmt(val)}X${j+1}`;
                    else          augHTML += ` - ${fmt(Math.abs(val))}X${j+1}`;
                }

                for (let s = 0; s < numConstraints; s++) {
                    if (s === i) augHTML += ` + 1S${s+1}`;
                    else         augHTML += ` + 0S${s+1}`;
                }

                augHTML += ` = ${fmt(rhs[i])}<br>`;
            }
            augHTML += `</div>`;
            outputDiv.innerHTML += augHTML;
            let iteration = 1;
            let optFlag = true;

            while (optFlag) {
                if (iteration > 100) {
                    outputDiv.innerHTML += `<p style="color:red">Max iterations reached.</p>`;
                    break;
                }

                let zRowMini = 0;
                let enterCol = -1;
                let enteringIsSlack = false;
                let enterSlackIdx = -1;

                for (let i = 0; i < numVars; i++) {
                    if (zVars[i] < zRowMini) {
                        zRowMini = zVars[i];
                        enterCol = i;
                        enteringIsSlack = false;
                    }
                }

                for (let i = 0; i < numConstraints; i++) {
                    if (zSlacks[i] < zRowMini) {
                        zRowMini = zSlacks[i];
                        enterCol = i; 
                        enteringIsSlack = true;
                        enterSlackIdx = i;
                    }
                }

                if (zRowMini >= -1e-9) {
                    
                    
                    let finalTableHTML = `<div class="iteration-box" style="border: 2px solid green; background-color: #f0fff0;">
                        <h4 style="color: green; margin-top:0;">Final Optimal Tableau</h4>
                        <table>
                        <tr><th>Basic</th><th>Z</th>`;
                    
                    for(let j=0; j<numVars; j++) finalTableHTML += `<th>x${j+1}</th>`;
                    for(let j=0; j<numConstraints; j++) finalTableHTML += `<th>s${j+1}</th>`;
                    finalTableHTML += `<th>RHS</th></tr>`;

                    finalTableHTML += `<tr><td>Z</td><td>1</td>`;
                    zVars.forEach(v => finalTableHTML += `<td>${fmt(v)}</td>`);
                    zSlacks.forEach(v => finalTableHTML += `<td>${fmt(v)}</td>`);
                    finalTableHTML += `<td>${fmt(zValue)}</td></tr>`;

                    for (let i = 0; i < numConstraints; i++) {
                        finalTableHTML += `<tr><td>${basicVarNames[i]}</td><td>0</td>`;
                        for (let j = 0; j < numVars; j++) finalTableHTML += `<td>${fmt(constraintsCo[i][j])}</td>`;
                        for (let j = 0; j < numConstraints; j++) finalTableHTML += `<td>${fmt(slacksCo[i][j])}</td>`;
                        finalTableHTML += `<td>${fmt(rhs[i])}</td></tr>`;
                    }
                    finalTableHTML += `</table></div>`;
                    outputDiv.innerHTML += finalTableHTML;

                    outputDiv.innerHTML += `<h3>Optimal Solution Reached</h3>`;
                    optFlag = false;
                    break;
                }
                

                let leaveRow = -1;
                let minRatio = Infinity;
                let ratios = [];

                for (let i = 0; i < numConstraints; i++) {
                    let coeff = enteringIsSlack ? slacksCo[i][enterSlackIdx] : constraintsCo[i][enterCol];
                    let r = -1;
                    
                    if (coeff > 1e-9) {
                        r = rhs[i] / coeff;
                        if (r < minRatio) {
                            minRatio = r;
                            leaveRow = i;
                        }
                    }
                    ratios.push(r);
                }

                if (leaveRow === -1) {
                    outputDiv.innerHTML += `<p style="color:red">Unbounded Solution.</p>`;
                    return;
                }

                let enteringName = enteringIsSlack ? `s${enterSlackIdx+1}` : `x${enterCol+1}`;
                
                let tableHTML = `<div class="iteration-box"><h4>Iteration ${iteration}</h4>`;
                tableHTML += `<p>Entering: <b>${enteringName}</b> | Leaving: <b>${basicVarNames[leaveRow]}</b></p>`;
                tableHTML += `<table><tr><th>Basic</th><th>Z</th>`;
                
                for(let j=0; j<numVars; j++) tableHTML += `<th>x${j+1}</th>`;
                for(let j=0; j<numConstraints; j++) tableHTML += `<th>s${j+1}</th>`;
                tableHTML += `<th>RHS</th><th>Ratio</th></tr>`;

                tableHTML += `<tr><td>Z</td><td>1</td>`;
                zVars.forEach((v, idx) => {
                    let isPivCol = (!enteringIsSlack && idx === enterCol);
                    tableHTML += `<td class="${isPivCol ? 'pivot-col' : ''}">${fmt(v)}</td>`;
                });
                zSlacks.forEach((v, idx) => {
                    let isPivCol = (enteringIsSlack && idx === enterSlackIdx);
                    tableHTML += `<td class="${isPivCol ? 'pivot-col' : ''}">${fmt(v)}</td>`;
                });
                tableHTML += `<td>${fmt(zValue)}</td><td>-</td></tr>`;

                for (let i = 0; i < numConstraints; i++) {
                    let isPivRow = (i === leaveRow);
                    tableHTML += `<tr class="${isPivRow ? 'pivot-row' : ''}">`;
                    tableHTML += `<td>${basicVarNames[i]}</td><td>0</td>`;
                    
                    for (let j = 0; j < numVars; j++) {
                        let isPivCol = (!enteringIsSlack && j === enterCol);
                        let isPivEl = (isPivRow && isPivCol);
                        tableHTML += `<td class="${isPivEl ? 'pivot-element' : (isPivCol ? 'pivot-col' : '')}">${fmt(constraintsCo[i][j])}</td>`;
                    }
                    
                    for (let j = 0; j < numConstraints; j++) {
                        let isPivCol = (enteringIsSlack && j === enterSlackIdx);
                        let isPivEl = (isPivRow && isPivCol);
                        tableHTML += `<td class="${isPivEl ? 'pivot-element' : (isPivCol ? 'pivot-col' : '')}">${fmt(slacksCo[i][j])}</td>`;
                    }

                    tableHTML += `<td>${fmt(rhs[i])}</td>`;
                    tableHTML += `<td>${ratios[i] !== -1 ? fmt(ratios[i]) : '-'}</td></tr>`;
                }
                tableHTML += `</table></div>`;
                outputDiv.innerHTML += tableHTML;

                let pivotElement = enteringIsSlack ? slacksCo[leaveRow][enterSlackIdx] : constraintsCo[leaveRow][enterCol];

                for (let j = 0; j < numVars; j++) constraintsCo[leaveRow][j] /= pivotElement;
                for (let j = 0; j < numConstraints; j++) slacksCo[leaveRow][j] /= pivotElement;
                rhs[leaveRow] /= pivotElement;

                basicVarNames[leaveRow] = enteringName;

                for (let i = 0; i < numConstraints; i++) {
                    if (i !== leaveRow) {
                        let factor = enteringIsSlack ? slacksCo[i][enterSlackIdx] : constraintsCo[i][enterCol];
                        for (let j = 0; j < numVars; j++) constraintsCo[i][j] -= factor * constraintsCo[leaveRow][j];
                        for (let j = 0; j < numConstraints; j++) slacksCo[i][j] -= factor * slacksCo[leaveRow][j];
                        rhs[i] -= factor * rhs[leaveRow];
                    }
                }

                let zFactor = enteringIsSlack ? zSlacks[enterSlackIdx] : zVars[enterCol];
                for (let j = 0; j < numVars; j++) zVars[j] -= zFactor * constraintsCo[leaveRow][j];
                for (let j = 0; j < numConstraints; j++) zSlacks[j] -= zFactor * slacksCo[leaveRow][j];
                zValue -= zFactor * rhs[leaveRow];

                iteration++;
            }

            let finalResHTML = `<div class="optimal-res">Max Z = ${fmt(zValue)}</div><br>Variables:<br>`;
            
            for (let i = 0; i < numVars; i++) {
                let name = `x${i+1}`;
                let val = 0.0;
                for (let r = 0; r < numConstraints; r++) {
                    if (basicVarNames[r] === name) {
                        val = rhs[r];
                        break;
                    }
                }
                finalResHTML += `${name} = ${fmt(val)}<br>`;
            }
             for (let i = 0; i < numConstraints; i++) {
                let name = `s${i+1}`;
                let val = 0.0;
                for (let r = 0; r < numConstraints; r++) {
                    if (basicVarNames[r] === name) {
                        val = rhs[r];
                        break;
                    }
                }
                finalResHTML += `${name} = ${fmt(val)}<br>`;
            }

            outputDiv.innerHTML += finalResHTML;
        }
const NAMESPACE = 'simplex-visualizer-unique-id';
const KEY_VISITS = 'site-visits';
const KEY_SOLVED = 'problems-solved';

// 1. Initialize Stats on Page Load
function initStats() {
    // --- Handle Visits (Session Logic) ---
    const hasVisitedSession = sessionStorage.getItem('hasVisitedSession');
    const visitUrl = hasVisitedSession 
        ? `https://api.counterapi.dev/v1/${NAMESPACE}/${KEY_VISITS}/` 
        : `https://api.counterapi.dev/v1/${NAMESPACE}/${KEY_VISITS}/up`;

    fetch(visitUrl)
        .then(res => res.json())
        .then(data => {
            document.getElementById('visit-count').innerText = data.count;
            if (!hasVisitedSession) sessionStorage.setItem('hasVisitedSession', 'true');
        })
        .catch(() => document.getElementById('visit-count').innerText = "-");

    // --- Handle Solved (Read Only initially) ---
    // We only read the current count here, we don't add to it yet.
    fetch(`https://api.counterapi.dev/v1/${NAMESPACE}/${KEY_SOLVED}/`)
        .then(res => res.json())
        .then(data => {
            document.getElementById('solve-count').innerText = data.count;
        })
        .catch(() => document.getElementById('solve-count').innerText = "-");
}

// 2. Function to increment 'Solved' count
function trackSolveClick() {
    fetch(`https://api.counterapi.dev/v1/${NAMESPACE}/${KEY_SOLVED}/up`)
        .then(res => res.json())
        .then(data => {
            document.getElementById('solve-count').innerText = data.count;
        })
        .catch(err => console.log('Tracking blocked'));
}

// Run initialization
initStats();
    </script>
<div style="position: fixed; bottom: 10px; left: 10px; background: rgba(255, 255, 255, 0.95); padding: 8px 12px; border: 1px solid #ccc; border-radius: 5px; font-family: sans-serif; font-size: 13px; z-index: 1000; box-shadow: 0 2px 5px rgba(0,0,0,0.1);">
    <div style="margin-bottom: 4px;">Visits: <span id="visit-count">...</span></div>
    <div>Solved: <span id="solve-count">...</span></div>
</div>
</body>
</html>
